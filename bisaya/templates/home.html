{% extends 'base.html' %}
{% block content %}

{% if user %}
    <h1 class="mb-3">Hello {{ user }}!</h1>
{% else %}
    <h1 class="mb-3">Inventory Management System</h1>
{% endif %}

{% if low_stock_count > 0 %}
    <div class="alert alert-warning">
        <h5 class="alert-heading">⚠ Low Stock Alert</h5>
        <p>You have <strong>{{ low_stock_count }}</strong> item(s) running low on stock.</p>
        <ul class="mb-0">
            {% for inventory in low_stock_items %}
                {% set product = inventory.product %}
                <li>{{ product.productName }} — Only {{ inventory.quantityOnHand }} units remaining (SKU: {{ inventory.SKU }})</li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h2 class="m-0">Current Stock Levels</h2>
        <small class="text-muted">Manage your products and inventory</small>
    </div>
    <div>
        <a class="btn btn-outline-secondary me-2" href="{{ url_for('inventory_report') }}">Generate Report</a>
        <a class="btn btn-primary" href="{{ url_for('add_inventory') }}">+ Add Inventory</a>
    </div>
</div>

{% if inventory_items %}
        <div class="table-responsive">
            <table class="table table-striped table-hover table-sm align-middle">
            <thead class="table-dark">
                <tr>
                    <th>SKU</th>
                    <th>Product Name</th>
                    <th>Category</th>
                    <th>Quantity on Hand</th>
                    <th>Unit Measure</th>
                    <th>Price</th>
                    <th>Inventory Cost</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for inventory, product in inventory_items %}
                <tr>
                    <td>{{ inventory.SKU }}</td>
                    <td>{{ product.productName }}</td>
                    <td>{{ product.category }}</td>
                                <td>
                                    <a href="{{ url_for('update_quantity', sku=inventory.SKU) }}" class="text-decoration-none {{ 'text-danger fw-bold' if inventory.isLowStock else '' }}">{{ inventory.quantityOnHand }}</a>
                                </td>
                    <td>{{ inventory.unitMeasure }}</td>
                    <td>₱{{ "%.2f"|format(product.price) }}</td>
                    <td>₱{{ "%.2f"|format(inventory.inventoryCost) }}</td>
                    <td>
                        {% if inventory.isLowStock %}
                            <span class="badge bg-danger">Low Stock</span>
                        {% else %}
                            <span class="badge bg-success">In Stock</span>
                        {% endif %}
                    </td>
                                <td>
                                    <div class="d-flex gap-1">
                                        <a href="{{ url_for('update_inventory_item', sku=inventory.SKU) }}" class="btn btn-sm btn-outline-primary">Edit</a>
                                        <form method="POST" action="{{ url_for('delete_inventory', sku=inventory.SKU) }}" onsubmit="return confirm('Are you sure you want to delete {{ product.productName }}?');" style="display:inline">
                                            <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                                        </form>
                                    </div>
                                </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <p>No inventory items found. <a href="{{ url_for('add_inventory') }}">Add your first item</a></p>
{% endif %}

{% endblock %}